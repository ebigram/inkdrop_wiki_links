{"version":3,"sources":["../src/wiki_link.js"],"names":["db","inkdrop","main","dataStore","getLocalDB","createRemarkWikiLink","OriginalSpan","WikiLink","React","Component","render","link","props","children","attributes","className","onClick","event","preventDefault","stopPropagation","utils","search","then","note","noteToOpenId","docs","length","_id","editingNote","store","getState","notes","createId","put","_rev","undefined","body","title","createdAt","Date","now","updatedAt","commands","dispatch","document","noteId","renderError","error","message","e","PropTypes","arrayOf","string"],"mappings":";AAAA;;;;;;;AACA;;AACA;;;;;;;;;;;;AAEA,MAAMA,EAAE,GAAGC,OAAO,iBAAIA,OAAJ,8DAAI,SAASC,IAAb,2EAAI,cAAeC,SAAnB,0DAAI,sBAA0BC,UAA1B,EAAJ,CAAlB;;AAEA,MAAMC,oBAAoB,GAAIC,YAAD,IAAkB;AAAA;;AAC3C,0BAAO,MAAMC,QAAN,SAAuBC,KAAK,CAACC,SAA7B,CAAuC;AAK1CC,IAAAA,MAAM,GAAG;AACL;AACA,YAAMC,IAAI,GAAG,KAAKC,KAAL,CAAWC,QAAX,CAAoB,CAApB,CAAb;;AACA,UAAIF,IAAJ,EAAU;AACN,YAAI;AACA,gBAAMG,UAAU,GAAG;AACfC,YAAAA,SAAS,EAAE,WADI;AAEf;AACAC,YAAAA,OAAO,EAAGC,KAAD,IAAW;AAChB;;AACA,kBAAIjB,EAAJ,EAAQ;AACJiB,gBAAAA,KAAK,CAACC,cAAN;AACAD,gBAAAA,KAAK,CAACE,eAAN;AACAnB,gBAAAA,EAAE,CAACoB,KAAH,CACKC,MADL,CACa,SAAQV,IAAK,EAD1B,EAEKW,IAFL,CAEWC,IAAD,IAAU;AACZ;AACA,sBAAIC,YAAJ;;AACA,sBACID,IAAI,SAAJ,IAAAA,IAAI,WAAJ,IAAAA,IAAI,CAAEE,IAAN,IACAF,IAAI,CAACE,IAAL,CAAUC,MAAV,GAAmB,CAFvB,EAGE;AACEF,oBAAAA,YAAY,GAAGD,IAAI,CAACE,IAAL,CAAU,CAAV,EAAaE,GAA5B;AACH,mBALD,MAKO;AACH,0BAAM;AACFC,sBAAAA;AADE,wBAEF3B,OAAO,CAAC4B,KAAR,CAAcC,QAAd,EAFJ;AAGAN,oBAAAA,YAAY,GAAGxB,EAAE,CAAC+B,KAAH,CAASC,QAAT,EAAf;AACAhC,oBAAAA,EAAE,CAAC+B,KAAH,CAASE,GAAT,CAAa,EACT,GAAGL,WADM;AAETD,sBAAAA,GAAG,EAAEH,YAFI;AAGTU,sBAAAA,IAAI,EAAEC,SAHG;AAITC,sBAAAA,IAAI,EAAE,EAJG;AAKTC,sBAAAA,KAAK,EAAE1B,IALE;AAMT2B,sBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EANF;AAOTC,sBAAAA,SAAS,EAAEF,IAAI,CAACC,GAAL;AAPF,qBAAb;AASH;;AACDvC,kBAAAA,OAAO,CAACyC,QAAR,CAAiBC,QAAjB,CACIC,QAAQ,CAACR,IADb,EAEI,gBAFJ,EAGI;AAAES,oBAAAA,MAAM,EAAErB;AAAV,mBAHJ;AAKH,iBA9BL;AAgCA,uBAAO,KAAP;AACH;AACJ,aA1Cc;AA2CfsB,YAAAA,WAAW,EAAGC,KAAD,IAAW;AACpB,kCACI;AAAM,gBAAA,SAAS,EAAC;AAAhB,iBACKA,KAAK,CAACC,OADX,CADJ;AAKH;AAjDc,WAAnB;;AAmDA,cAAI1C,YAAJ,EAAkB;AACd,gCAAO,oBAAC,YAAD,OAAP;AACH,WAFD,MAEO;AACH;AACA,gCAAO,4BAAUQ,UAAV,EAAuBH,IAAvB,CAAP;AACH;AACJ,SA1DD,CA0DE,OAAOsC,CAAP,EAAU;AACR,8BAAO,kCAAOA,CAAC,CAACD,OAAT,CAAP;AACH;AACJ,OA9DD,MA8DO;AACH,4BAAO,sDAAP;AACH;AACJ;;AAzEyC,GAA9C,uCACuB;AACfnC,IAAAA,QAAQ,EAAEqC,mBAAUC,OAAV,CAAkBD,mBAAUE,MAA5B;AADK,GADvB;AA2EH,CA5ED;;eA8Ee/C,oB","sourcesContent":["\"use babel\";\nimport * as React from \"react\";\nimport PropTypes from \"prop-types\";\n\nconst db = inkdrop && inkdrop?.main?.dataStore?.getLocalDB();\n\nconst createRemarkWikiLink = (OriginalSpan) => {\n    return class WikiLink extends React.Component {\n        static propTypes = {\n            children: PropTypes.arrayOf(PropTypes.string),\n        };\n\n        render() {\n            debugger;\n            const link = this.props.children[0];\n            if (link) {\n                try {\n                    const attributes = {\n                        className: \"wiki_link\",\n                        // href: `inkdrop://note/${link}`,\n                        onClick: (event) => {\n                            debugger;\n                            if (db) {\n                                event.preventDefault();\n                                event.stopPropagation();\n                                db.utils\n                                    .search(`title:${link}`)\n                                    .then((note) => {\n                                        debugger;\n                                        let noteToOpenId;\n                                        if (\n                                            note?.docs &&\n                                            note.docs.length > 0\n                                        ) {\n                                            noteToOpenId = note.docs[0]._id;\n                                        } else {\n                                            const {\n                                                editingNote,\n                                            } = inkdrop.store.getState();\n                                            noteToOpenId = db.notes.createId();\n                                            db.notes.put({\n                                                ...editingNote,\n                                                _id: noteToOpenId,\n                                                _rev: undefined,\n                                                body: \"\",\n                                                title: link,\n                                                createdAt: Date.now(),\n                                                updatedAt: Date.now(),\n                                            });\n                                        }\n                                        inkdrop.commands.dispatch(\n                                            document.body,\n                                            \"core:open-note\",\n                                            { noteId: noteToOpenId }\n                                        );\n                                    });\n\n                                return false;\n                            }\n                        },\n                        renderError: (error) => {\n                            return (\n                                <span className=\"ui error message mde-error-message\">\n                                    {error.message}\n                                </span>\n                            );\n                        },\n                    };\n                    if (OriginalSpan) {\n                        return <OriginalSpan />;\n                    } else {\n                        // debugger;\n                        return <span {...attributes}>{link}</span>;\n                    }\n                } catch (e) {\n                    return <span>{e.message}</span>;\n                }\n            } else {\n                return <span>Invalid Wiki Link</span>;\n            }\n        }\n    };\n};\n\nexport default createRemarkWikiLink;\n"],"file":"wiki_link.js"}